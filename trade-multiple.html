<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Post Discord</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
      body {
        background-color: #1e1e1e;
        /* Tema gelap */
        color: #fff;
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        background-color: #333;
        /* Warna latar belakang card */
        color: #fff;
        border: none;
        border-radius: 10px;
        padding: 20px;
        text-align: center;
      }
      #messageStatus {
        margin-bottom: 20px;
        overflow-y: auto;
        max-height: 150px;
        /* Batas tinggi untuk pesan sukses */
      }
      .success-counter {
        color: #27ae60;
        /* Warna untuk counter sukses */
      }
      .error-counter {
        color: #c0392b;
        /* Warna untuk counter error */
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="card">
        <h1 class="mb-2">Auto Post Trade</h1>
        <h6 class="mb-3" id="last_send">Last Sent: </h6>
        <div id="messageStatus"></div>
      </div>
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const Authorization = `ODk4NDA2MTA1NzYyMzk4MjM5.GI5ryL.QK4rxoGZ1DcxTPKb30u896KBUh4sfP3pXet7II`

        const channels = [
          { channel_id: '1222147024955244554', name: 'ToyCp', delayMinutes: 31 },
          { channel_id: '1130967592232820827', name: 'CPS-Trade', delayMinutes: 11 },
          { channel_id: '1173287029606461560', name: 'CrapCP-Buy Sell', delayMinutes: 31 },
          { channel_id: '1208601553552801812', name: 'KfnCp', delayMinutes: 31 },
          { channel_id: '1130618760655544380', name: 'BuraaCp', delayMinutes: 31 },
          { channel_id: '1140403170267365517', name: 'GMart-CPS Lock', delayMinutes: 121 }
        ];
      
        let successCounter = {}; // Object untuk menyimpan counter sukses
        let errorCounter = {}; // Object untuk menyimpan counter error
      
        function sendMessage(channel) {
          const messageStatus = document.getElementById('messageStatus');
          const statusMessage = document.createElement('p');
          statusMessage.classList.add('mb-0'); // Tambahkan margin bawah pada setiap pesan
      
          const delayText = `${channel.delayMinutes} mins`;
      
          statusMessage.innerHTML = `Sending message to ${channel.name}... (Delay: ${delayText})`;
          messageStatus.insertBefore(statusMessage, messageStatus.firstChild); // Tambahkan pesan baru di bagian atas
          
          let payload = JSON.stringify({
            content: `
> # <a:flash29:1222666884399497338>TOY STORE<a:flash29:1222666884399497338> 
> ----------------------------
> # BUY? DM <@898406105762398239> <a:trustedseller:1222187904348983448> 
> ## <a:estrela88:1222670967957094400> SELL LIST  <a:estrela88:1222670967957094400> 
> ** <a:arrowright21:1224977661672030239>SELL <a:blackgemlock:1224009228822380565> PASTI MURAH, RATE DM !! **
> ** <a:arrowright21:1224977661672030239>SELL <a:bluegemlock:1224010170439303290> PASTI MURAH, RATE DM !! **
> ** <a:arrowright21:1224977661672030239>SELL <:creativecoin:1224009642179428503> IDR. 16.000 /  VIA <a:bglv2:1113663878690250832> AT <a:arrowright22:1224011662420345014> 4G**
> ** <a:arrowright21:1224977661672030239>SELL <:mray:1224010387200933909> IDR. 40.000 **
> ** <a:arrowright21:1224977661672030239>SELL <a:igl:1224011470061178992> IDR. 14.000 **
> ** <a:arrowright21:1224977661672030239>SELL <:lray:1224010502443634719> IDR. 3.000 **
> ## <a:estrela88:1222670967957094400> BUY LIST <a:estrela88:1222670967957094400> 
> ** <a:arrowright21:1224977661672030239> BUY TONS <a:blackgemlock:1224009228822380565> RATE DM !! **
> ** <a:arrowright21:1224977661672030239> BUY TONS <a:bluegemlock:1224010170439303290> RATE DM !! **
> # <a:estrela88:1222670967957094400> PAYMENT <a:estrela88:1222670967957094400> 
> ** <a:arrowright21:1224977661672030239> <:dana:1224009791286935592> DANA / <:gopay:1224982994700210196> GOPAY / <:shopeepay:1224982990241665085> SPAY**
> ** <a:arrowright21:1224977661672030239> <:jago:1224982992271708211> JAGO / <:qris2:1224861080962990163> QRIS [ALL PAYMENT NO TAX]**
> # BUY? DM <@898406105762398239> <a:trustedseller:1222187904348983448>
> **<a:arrowright21:1224977661672030239> IDR PAYMENT ONLY <a:flag_id:1224013007995273326>  **
> **<a:arrowright21:1224977661672030239> FAST RESPOND & DROP <a:verified1:1224981671024136323> **
> **<a:arrowright21:1224977661672030239> ROLE GOD MAX <:god:1222196157992800376> **
> # <a:flash29:1222666884399497338>TOY STORE<a:flash29:1222666884399497338>
> ----------------------------
> || Always giveaway, check my profile !! || <@898406105762398239>
            `
          });

          if (channel.channel_id === '1140403170267365517') {
            payload = JSON.stringify({
              content: `
**SELL <a:bluegemlock:1224010170439303290> RATE DM !!
SELL <a:blackgemlock:1224009228822380565> RATE DM !!
SELL <:creativecoin:1224009642179428503> 16.000
SELL <:Mray:1140501066811703366> 40.000
IDR PAYMENT <a:indo:1213790198123470848> 
<:dana:1224009791286935592> | <:gopay:1224982994700210196> | <:shopeepay:1224982990241665085> | <:jago:1224982992271708211> 
BUY? DM <@898406105762398239>**
              `
            });
          }
      
          const url = `https://discord.com/api/v9/channels/${channel.channel_id}/messages`;
          const headers = {
            'Content-Type': 'application/json',
            'Authorization': Authorization
          };
      
          const xhr = new XMLHttpRequest();
          xhr.open('POST', url, true);
          Object.keys(headers).forEach(key => xhr.setRequestHeader(key, headers[key]));
      
          xhr.onreadystatechange = function () {
            if (xhr.readyState === XMLHttpRequest.DONE) {
              if (xhr.status === 200) {
                successCounter[channel.channel_id] = (successCounter[channel.channel_id] || 0) + 1; // Tambahkan counter sukses
                statusMessage.innerHTML = `Successfully sent to <span style="color: #fff">${channel.name}</span> (Delay: ${delayText}) | <span style="color: #fff">x${successCounter[channel.channel_id]} times!</span>`;
                statusMessage.classList.add('success-counter'); // Tambahkan kelas untuk warna sukses
                updateLastSend(); // Memperbarui waktu terakhir pengiriman
                send_report(true, `${channel.name}`, `${delayText}`, `${successCounter[channel.channel_id]}`)
              } else {
                errorCounter[channel.channel_id] = (errorCounter[channel.channel_id] || 0) + 1; // Tambahkan counter error
                statusMessage.innerHTML = `Error sending to <span style="color: #fff">${channel.name}</span> : ${xhr.status} (Delay: ${delayText}) | <span style="color: #fff">x${errorCounter[channel.channel_id]} times!</span>`;
                statusMessage.classList.add('error-counter'); // Tambahkan kelas untuk warna error
                send_report(false, `${channel.name}`, `${delayText}`, `${errorCounter[channel.channel_id]}`)
              }
            }
          };
      
          xhr.send(payload);
        }
      
        function send_report(status, channel_name, delay, counter)
        {
          const channel = '1224492227078652014'
          let payload = JSON.stringify({
            content: `
> ### <a:verified:1176176963195510905> Successfully sent to *${channel_name}* (Delay: ${delay}) | x${counter} times!
> <a:arrow:1098931051046379611>report: *cc promote* <@898406105762398239>
            `
          }); 

          if (status === false) {
            payload = JSON.stringify({
              content: `
> ### <a:cross:1207285626257281034> Error sending to *${channel_name}* (Delay: ${delay}) | x${counter} times!
> <a:arrow:1098931051046379611>report: *trade promote* <@898406105762398239>
              `
            })
          }

          const url = `https://discord.com/api/v9/channels/${channel}/messages`;

          const headers = {
            'Content-Type': 'application/json',
            'Authorization': Authorization
          };
      
          const xhr = new XMLHttpRequest();
          xhr.open('POST', url, true);
          Object.keys(headers).forEach(key => xhr.setRequestHeader(key, headers[key]));

          xhr.onreadystatechange = function () {
            // TODO:
          };
      
          xhr.send(payload);
        }

        function updateLastSend() {
          const lastSendElement = document.getElementById('last_send');
          const currentDate = new Date();
          const options = { timeZone: 'Asia/Jakarta', hour12: false, day: '2-digit', month: '2-digit', hour: '2-digit', minute: '2-digit' };
          const formattedDate = currentDate.toLocaleString('en-US', options);
          lastSendElement.textContent = `Last Sent: ${formattedDate} WIB`;
        }
      
        channels.forEach(channel => {
          sendMessage(channel); // Mengirim pesan pertama kali
          setInterval(() => {
            sendMessage(channel); // Mengirim pesan secara berkala
          }, channel.delayMinutes * 60000); // Mengalikan menit dengan 60000 untuk mendapatkan nilai dalam milidetik
        });
      });
    </script>
  </body>
</html>